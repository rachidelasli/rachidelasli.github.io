var H5P=H5P||{};H5P.DragNDrop=function(dnb,$container){H5P.EventDispatcher.call(this);this.dnb=dnb;this.$container=$container;this.scrollLeft=0;this.scrollTop=0;};H5P.DragNDrop.prototype=Object.create(H5P.EventDispatcher.prototype);H5P.DragNDrop.prototype.constructor=H5P.DragNDrop;H5P.DragNDrop.prototype.setElement=function($element){this.$element=$element;};H5P.DragNDrop.prototype.press=function($element,x,y){var that=this;var eventData={instance:this};H5P.$window.mousemove(eventData,H5P.DragNDrop.moveHandler).bind('mouseup',eventData,H5P.DragNDrop.release);H5P.$body.css({'-moz-user-select':'none','-webkit-user-select':'none'}).attr('unselectable','on')[0].onselectstart=H5P.$body[0].ondragstart=function(){return false;};that.containerOffset=$element.offsetParent().offset();this.$element=$element;this.moving=false;this.startX=x;this.startY=y;this.marginX=parseInt($element.css('marginLeft'))+parseInt($element.css('marginRight'));this.marginY=parseInt($element.css('marginTop'))+parseInt($element.css('marginBottom'));var offset=$element.offset();this.adjust={x:x-offset.left+this.marginX,y:y-offset.top-this.marginY};if(that.dnb&&that.dnb.newElement){this.move(x,y);}};H5P.DragNDrop.moveHandler=function(event){event.stopPropagation();event.data.instance.move(event.pageX,event.pageY);};H5P.DragNDrop.prototype.move=function(x,y){var that=this;if(!that.moving){if(that.startMovingCallback!==undefined&&!that.startMovingCallback(x,y)){return;}
that.moving=true;that.$element.addClass('h5p-moving');}
x-=that.adjust.x;y-=that.adjust.y;var posX=x-that.containerOffset.left+that.scrollLeft;var posY=y-that.containerOffset.top+that.scrollTop;if(that.snap!==undefined){posX=Math.round(posX/that.snap)*that.snap;posY=Math.round(posY/that.snap)*that.snap;}
if(that.min!==undefined){if(posX<that.min.x){posX=that.min.x;x=that.min.x+that.containerOffset.left-that.scrollLeft;}
if(posY<that.min.y){posY=that.min.y;y=that.min.y+that.containerOffset.top-that.scrollTop;}}
if(that.dnb&&that.dnb.newElement&&posY>=0){that.min.y=0;}
if(that.max!==undefined){if(posX>that.max.x){posX=that.max.x;x=that.max.x+that.containerOffset.left-that.scrollLeft;}
if(posY>that.max.y){posY=that.max.y;y=that.max.y+that.containerOffset.top-that.scrollTop;}}
var startX=that.startX-that.adjust.x-that.containerOffset.left+that.scrollLeft;var startY=that.startY-that.adjust.y-that.containerOffset.top+that.scrollTop;if(!that.snap&&(posX!==startX||posY!==startY)){that.trigger('showTransformPanel');}
else if(that.snap){var xChanged=(Math.round(posX/that.snap)*that.snap)!==(Math.round(startX/that.snap)*that.snap);var yChanged=(Math.round(posY/that.snap)*that.snap)!==(Math.round(startY/that.snap)*that.snap);if(xChanged||yChanged){that.trigger('showTransformPanel');}}
that.$element.css({left:posX,top:posY});if(that.dnb){that.dnb.updateCoordinates();}
if(that.moveCallback!==undefined){that.moveCallback(x,y,that.$element);}};H5P.DragNDrop.release=function(event){var that=event.data.instance;H5P.$window.unbind('mousemove',H5P.DragNDrop.moveHandler).unbind('mouseup',H5P.DragNDrop.release);H5P.$body.css({'-moz-user-select':'','-webkit-user-select':''}).removeAttr('unselectable')[0].onselectstart=H5P.$body[0].ondragstart=null;if(that.releaseCallback!==undefined){that.releaseCallback();}
if(that.moving){that.$element.removeClass('h5p-moving');if(that.stopMovingCallback!==undefined){that.stopMovingCallback(event);}}
that.trigger('hideTransformPanel');};