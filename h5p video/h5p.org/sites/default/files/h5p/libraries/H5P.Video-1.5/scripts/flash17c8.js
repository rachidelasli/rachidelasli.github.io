H5P.VideoFlash=(function($){function Flash(sources,options){var self=this;var $wrapper=$('<div/>',{'class':'h5p-video-flash',css:{width:'100%',height:'100%'}});var $error=$('<div/>',{'class':'h5p-video-error'});var stateBeforeChangingQuality;var currentTimeBeforeChangingQuality;var currentQuality;var playerOptions={buffering:true,clip:{url:sources[0].path,autoPlay:options.autoplay,autoBuffering:true,scaling:'fit',onSeek:function(){if(stateBeforeChangingQuality){}},onMetaData:function(){setTimeout(function(){if(stateBeforeChangingQuality!==undefined){fp.seek(currentTimeBeforeChangingQuality);if(stateBeforeChangingQuality===H5P.Video.PLAYING){fp.play();}
stateBeforeChangingQuality=undefined;if($error.is(':visible')){$error.remove();}}
else{self.trigger('ready');self.trigger('loaded');}},0);},onBegin:function(){self.trigger('stateChange',H5P.Video.PLAYING);},onResume:function(){self.trigger('stateChange',H5P.Video.PLAYING);},onPause:function(){self.trigger('stateChange',H5P.Video.PAUSED);},onFinish:function(){self.trigger('stateChange',H5P.Video.ENDED);},onError:function(code,message){console.log('ERROR',code,message);self.trigger('error',message);}},plugins:{controls:null},play:null,onPlaylistReplace:function(){that.playlistReplaced();}};if(options.controls){playerOptions.plugins.controls={};delete playerOptions.play;}
var fp=flowplayer($wrapper[0],{src:"http://releases.flowplayer.org/swf/flowplayer-3.2.16.swf",wmode:"opaque"},playerOptions);self.appendTo=function($container){$wrapper.appendTo($container);};self.getQualities=function(){return;};self.getQuality=function(){return currentQuality;};self.setQuality=function(quality){if(qualities[quality]===undefined||quality===currentQuality){return;}
setPreferredQuality(quality);if(!stateBeforeChangingQuality){stateBeforeChangingQuality=lastState;currentTimeBeforeChangingQuality=video.currentTime;}
currentQuality=quality;self.trigger('qualityChange',currentQuality);self.trigger('stateChange',H5P.Video.BUFFERING);fp.setClip(qualities[quality].source.path);fp.startBuffering();};self.play=function(){if($error.is(':visible')){return;}
fp.play();};self.pause=function(){fp.pause();};self.seek=function(time){fp.seek(time);};self.getCurrentTime=function(){return fp.getTime();};self.getDuration=function(){return fp.getClip().metaData.duration;};self.getBuffered=function(){return fp.getClip().buffer;};self.mute=function(){fp.mute();};self.unMute=function(){fp.unmute();};self.isMuted=function(){return fp.muted;};self.getVolume=function(){return fp.volumeLevel*100;};self.setVolume=function(level){fp.volume(level/100);};self.on('resize',function(){var $object=H5P.jQuery(fp.getParent()).children('object');var clip=fp.getClip();if(clip!==undefined){$object.css('height',$object.width()*(clip.metaData.height/clip.metaData.width));}});}
Flash.canPlay=function(sources){for(var i=0;i<sources.length;i++){if(sources[i].mime==='video/mp4'||/\.mp4$/.test(sources[i].mime)){return true;}}};return Flash;})(H5P.jQuery);H5P.videoHandlers=H5P.videoHandlers||[];H5P.videoHandlers.push(H5P.VideoFlash);