H5P.DragNBarElement=(function($,ContextMenu,EventDispatcher){function DragNBarElement(dragNBar,clipboardData,options){var self=this;EventDispatcher.call(this);this.dnb=dragNBar;this.options=options||{};if(!this.options.disableContextMenu){this.contextMenu=new ContextMenu(this.dnb.$dialogContainer,this,this.options.hasCoordinates,this.options.disableResize,this.options.disableCopy,this.options.directionLock);}
this.focused=false;if(this.options.createElement){this.$element=this.options.createElement().appendTo(dragNBar.$container);this.focus();}
else{this.$element=this.options.element;}
if(this.$element){if(this.dnb.isEditor){this.$element.mousedown(function(){self.dnb.pressed=true;});}
this.$element.focus(function(){self.focus();});}
self.toClipboard=function(width,height){if(clipboardData&&localStorage){clipboardData.width=width;clipboardData.height=height;H5P.setClipboard(clipboardData);}};}
DragNBarElement.prototype=Object.create(EventDispatcher.prototype);DragNBarElement.prototype.constructor=DragNBarElement;DragNBarElement.prototype.addButton=function(name,label){this.contextMenu.addToMenu({name:name,label:label});};DragNBarElement.prototype.getElement=function(){return this.$element;};DragNBarElement.prototype.setElement=function($element){var self=this;this.$element=$element;this.$element.focus(function(){self.focus();});};DragNBarElement.prototype.showContextMenu=function(){if(this.contextMenu){this.contextMenu.attach();}};DragNBarElement.prototype.hideContextMenu=function(){if(this.contextMenu){this.contextMenu.detach();}};DragNBarElement.prototype.updateCoordinates=function(left,top,x,y){if(this.contextMenu){this.contextMenu.updateCoordinates(left,top,x,y);this.resizeContextMenu(x);}};DragNBarElement.prototype.resizeContextMenu=function(left){if(this.options.disableContextMenu){return;}
var paddingLeft=Number(this.contextMenu.$parent.css('padding-left').replace('px',''));left=(left||this.$element.position().left)+paddingLeft;var containerWidth=this.dnb.$container.width();var $cm=this.contextMenu.$contextMenu;$cm.css({position:'absolute',left:0});var contextMenuWidth=$cm.outerWidth(true);$cm.css({position:'',left:left});var isTooWide=left+contextMenuWidth>=containerWidth;if(isTooWide){var newLeft=left-contextMenuWidth;this.contextMenu.$contextMenu.css('left',newLeft+'px');this.contextMenu.$contextMenu.addClass('left-aligned');}
else{this.contextMenu.$contextMenu.removeClass('left-aligned');}};DragNBarElement.prototype.blur=function(){if(this.$element){this.$element.removeClass('focused');this.focused=false;if(!this.options.disableContextMenu){this.contextMenu.trigger('contextMenuTransform',{showTransformPanel:false});}}
this.hideContextMenu();};DragNBarElement.prototype.focus=function(){this.$element.addClass('focused');this.focused=true;if(this.contextMenu){this.resizeContextMenu(this.$element.position().left);}};DragNBarElement.prototype.removeElement=function(){this.$element.detach();this.hideContextMenu();};return DragNBarElement;})(H5P.jQuery,H5P.DragNBarContextMenu,H5P.EventDispatcher);